---
// src/Components/Contact/ContactMap.astro
import { contactInfo } from '../../data/contactData';
import 'leaflet/dist/leaflet.css';
---

<div class="map-wrapper">
  <span class="subtitle">{contactInfo.map.title}</span>
  <div 
    id="contact-map" 
    class="contact-map"
  ></div>
</div>

<style>
  .map-wrapper {
    margin-top: 6rem;
    margin-bottom: 6rem;
    width: 100%;
  }
  
  .contact-map {
    width: 100%;
    height: 450px;
    border: 1px solid var(--nova-line);
    margin-top: 2rem;
    filter: grayscale(100%) invert(90%) contrast(120%);
  }
</style>

<script define:vars={{ coordinates: contactInfo.map.coordinates }} type="module">
  import L from 'leaflet';

  function initContactMap() {
    const el = document.getElementById('contact-map');
    if (!el) return;

    const map = L.map(el).setView([coordinates.lat, coordinates.lng], coordinates.zoom);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // Use a circle marker to avoid external icon asset issues in build.
    L.circleMarker([coordinates.lat, coordinates.lng], {
      radius: 8,
      color: '#eb6737',
      weight: 2,
      fillColor: '#eb6737',
      fillOpacity: 0.9,
    }).addTo(map);
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initContactMap, { once: true });
  } else {
    initContactMap();
  }
</script>

