---
import { methodSteps } from '../../data/homeContent';
import SectionHeader from '../Ui/SectionHeader.astro';
---

<section class="container mx-auto px-[5vw] mt-16 md:mt-32 pt-10 md:pt-16 relative z-10">
    
    <!-- HEADER DELLA SEZIONE -->
    <SectionHeader 
        subtitle="Il Processo" 
        title="Un metodo chiaro,<br>per lavori che funzionano."
    >
        <!-- QUESTO È IL TESTO CHE MANCAVA -->
        <p class="mt-4 md:mt-6 text-nova-text text-[0.92rem] md:text-[1.1rem] font-light leading-[1.5] md:leading-[1.7]">
            Novaterra è un’impresa moderna, organizzata e affidabile. Seguiamo ogni progetto con una procedura precisa e trasparente.
        </p>
    </SectionHeader>

    <!-- GRIGLIA STEP (Stile tecnico, gap 1px) -->
    <div class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-[1px] bg-white/10 border border-white/10 reveal-fx">
        {methodSteps.map((item) => (
            <div class="method-card bg-nova-bg p-5 md:p-10 hover:bg-nova-surface transition-colors duration-300 flex flex-col h-full" data-expandable-card="method">
                
                <!-- Step Label -->
                <span class="text-nova-accent text-[0.7rem] md:text-[0.8rem] font-bold tracking-[0.1em] mb-2 md:mb-4 block">{item.step}</span>
                
                <!-- Icona -->
                <div class="text-[1.35rem] md:text-[2rem] text-nova-text mb-2 md:mb-6 font-[200]">{item.icon}</div>
                
                <!-- Titolo -->
                <h3 class="text-[1rem] md:text-[1.5rem] font-bold text-white mb-2 md:mb-4 leading-tight">{item.title}</h3>
                
                <!-- Descrizione (set:html per il testo colorato dei 100k) -->
                <p class="method-desc text-nova-muted text-[0.8rem] md:text-[1rem] leading-[1.4] md:leading-[1.7] font-light" set:html={item.desc}></p>
            </div>
        ))}
    </div>
</section>

<style>
  @media (max-width: 768px) {
    .method-card {
      cursor: pointer;
    }

    .method-desc {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .method-card.is-expanded .method-desc {
      display: block;
      overflow: visible;
    }
  }
</style>

<script is:inline>
  (() => {
    function isMobile() {
      return !!(window.matchMedia && window.matchMedia('(max-width: 768px)').matches);
    }

    function init() {
      const cards = Array.prototype.slice.call(document.querySelectorAll('[data-expandable-card="method"]'));
      if (!cards.length) return;

      cards.forEach((card) => {
        card.addEventListener('click', () => {
          if (!isMobile()) return;
          card.classList.toggle('is-expanded');
        });
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init, { once: true });
    } else {
      init();
    }
  })();
</script>
