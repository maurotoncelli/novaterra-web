---
// src/Components/Navbar.astro
import { navLinks, navConfig } from '../data/navData';
---
<nav class="navbar-main fixed top-0 left-0 w-full px-[5vw] flex justify-between items-center z-[100000] bg-nova-bg backdrop-blur-sm border-b border-white/10 transition-all duration-300">
    <a href="/" class="logo text-[1.2rem] font-light tracking-[0.05em] uppercase text-white hover:text-nova-accent transition-colors">
        {navConfig.logo.text}<span class="font-extrabold text-nova-accent">{navConfig.logo.accent}</span>
    </a>

    <!-- Dynamic cursor coordinates (GPS mock) -->
    <div id="gps-coords" class="navbar-coords font-mono text-nova-accent text-[12px] tracking-[0.12em] pointer-events-none opacity-0">
        43° 31' 36" N  10° 40' 54" E
    </div>

    <button id="menu-btn" class="menu-toggle relative text-[0.9rem] uppercase tracking-[0.1em] font-bold text-white hover:text-nova-accent transition-colors px-[10px] py-[10px]">
        <span id="menu-btn-text">Menu</span>
    </button>
</nav>

<div id="nav-overlay" class="fixed inset-0 bg-nova-bg z-[100001] -translate-y-full transition-transform duration-[800ms] ease-[cubic-bezier(0.19,1,0.22,1)]">
    
    <!-- Navbar dentro overlay -->
    <div class="overlay-navbar fixed top-0 left-0 w-full px-[5vw] flex justify-between items-center border-b border-white/10 z-[100002]">
        <a href="/" class="logo text-[1.2rem] font-light tracking-[0.05em] uppercase text-white hover:text-nova-accent transition-colors">
            {navConfig.logo.text}<span class="font-extrabold text-nova-accent">{navConfig.logo.accent}</span>
        </a>
        <button id="close-menu-btn" class="menu-toggle relative text-[0.9rem] uppercase tracking-[0.1em] font-bold text-white hover:text-nova-accent transition-colors px-[10px] py-[10px]">
            <span>Chiudi</span>
        </button>
    </div>
    
    <!-- Menu links centrati -->
    <div class="overlay-content flex flex-col items-center justify-center h-full">
        <ul class="text-center space-y-6">
            {navLinks.map(link => (
                <li class="overflow-hidden">
                    <a href={link.href} class="nav-link inline-block font-light text-[clamp(2rem,4vw,3.5rem)] text-white hover:text-nova-accent transition-all duration-500">
                        {link.label}
                    </a>
                </li>
            ))}
        </ul>
    </div>

    <!-- Footer dentro overlay -->
    <div class="overlay-footer fixed bottom-0 left-0 w-full px-[5vw] border-t border-white/10 z-[100002] bg-nova-bg">
        <div class="overlay-footer-inner flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="text-center md:text-left text-nova-muted text-xs">
                <span>&copy; 2026 Novaterra. P.IVA 02488820503.</span>
            </div>
            <div class="flex gap-6 text-xs">
                <a href="#" class="hover:text-nova-accent transition-colors text-nova-muted">Instagram</a>
                <a href="#" class="hover:text-nova-accent transition-colors text-nova-muted">Linkedin</a>
            </div>
        </div>
    </div>
</div>

<style>
    /* Make navbar height deterministic: avoid height + padding stacking (causes overlap issues) */
    .navbar-main,
    .overlay-navbar {
        height: var(--navbar-height);
        padding-top: 0;
        padding-bottom: 0;
    }

    .overlay-footer {
        height: var(--overlay-footer-height, 88px);
        padding-top: 1.25rem;
        padding-bottom: 1.25rem;
    }

    .overlay-footer-inner {
        max-width: var(--container-width, 1400px);
        margin: 0 auto;
    }

    .overlay-content {
        /* Keep links centered between overlay top bar and overlay footer */
        padding-top: var(--navbar-height);
        padding-bottom: var(--overlay-footer-height, 88px);
    }

    .navbar-coords {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        text-shadow: 0 0 10px rgba(205, 92, 47, 0.25);
        white-space: nowrap;
    }
    
    .menu-toggle::after {
        content: ''; position: absolute; bottom: 5px; right: 10px;
        width: calc(100% - 20px); height: 1px; background: #cd5c2f;
        transition: width 0.3s ease;
    }
    .menu-toggle:hover::after { width: calc(100% - 20px); }
    
    @media (max-width: 768px) {
        .navbar-main, .overlay-navbar {
            --navbar-height: 76px;
        }

        .overlay-footer {
            --overlay-footer-height: 96px;
        }

        /* Avoid overlap on small screens */
        .navbar-coords { display: none; }
    }
</style>

<script is:inline>
    const btn = document.getElementById('menu-btn');
    const closeBtn = document.getElementById('close-menu-btn');
    const text = document.getElementById('menu-btn-text');
    const overlay = document.getElementById('nav-overlay');

    function toggleMenu() {
        if (!overlay) return;
        const isActive = overlay.classList.toggle('translate-y-0');
        overlay.classList.toggle('-translate-y-full');
        if (text) text.textContent = isActive ? 'Chiudi' : 'Menu';
        document.body.style.overflow = isActive ? 'hidden' : '';
    }

    if (btn) {
        btn.addEventListener('click', toggleMenu);
    }
    
    if (closeBtn) {
        closeBtn.addEventListener('click', toggleMenu);
    }

    // Close overlay when clicking any menu link
    if (overlay) {
        overlay.querySelectorAll('a[href]').forEach((a) => {
            a.addEventListener('click', () => {
                // only close if menu is open
                if (overlay.classList.contains('translate-y-0')) toggleMenu();
            });
        });
    }
    
    // Close on ESC key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && overlay && overlay.classList.contains('translate-y-0')) {
            toggleMenu();
        }
    });
</script>
