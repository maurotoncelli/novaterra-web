---
// src/layouts/Layout.astro
import '../styles/global.css';
import 'lenis/dist/lenis.css';
import Footer from '../Components/Footer.astro';
import Navbar from '../Components/Navbar.astro';
import Preloader from '../Components/Ui/Preloader.astro';
import BackToTop from '../Components/Ui/BackToTop.astro';
import Analytics from '../Components/Ui/Analytics.astro';

interface Props {
	title: string;
	description?: string;
	showPreloader?: boolean;
	// NOTE: use explicit prop names to avoid any edge-case with reserved/ambiguous attribute names.
	canonicalHref?: string;
	robotsMeta?: string;
	// Back-compat aliases (in case some pages already use these names)
	canonical?: string;
	robots?: string;
}

const { 
	title = "NOVATERRA | Earth Engineering", 
	description = "Ingegneria del territorio e scavi in Toscana.",
	showPreloader = false,
	canonicalHref,
	robotsMeta,
	canonical,
	robots,
} = Astro.props;
---

<!doctype html>
<html lang="it">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<title>{title}</title>
		<meta name="description" content={description} />
		{(canonicalHref ?? canonical) && <link rel="canonical" href={(canonicalHref ?? canonical)!} />}
		{(robotsMeta ?? robots) && <meta name="robots" content={(robotsMeta ?? robots)!} />}
		<Analytics />
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		
		<!-- Leaflet CSS per mappa -->
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
		<!-- Leaflet JS per mappa -->
		<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
	</head>
	<body class="bg-nova-bg text-nova-text font-sans antialiased overflow-x-hidden selection:bg-nova-accent selection:text-white">
		
		{showPreloader && <Preloader />}
		<Navbar />

		<div class="noise-overlay fixed inset-0 pointer-events-none z-[9999] opacity-[0.03]"></div>
		<div class="cursor-cross"></div>

		<main id="main-content">
			<slot />
		</main>
		
		<BackToTop />
		
		<Footer />
<!-- Bundle site script (Vite) so it works in production/Netlify -->
<script type="module">
	import "/src/scripts/site.ts";
</script>

<style is:global>
			.noise-overlay {
				background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
			}
		</style>
	</body>
</html>
